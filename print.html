<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js lfe-pdp">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>LFE MACHINE MANUAL</title>
    
    <meta name="robots" content="noindex" />
    
    


    <!-- Custom HTML head -->
    


    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="The Manual for the Machine that is LFE/OTP">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    
    <link rel="stylesheet" href="fonts/fonts.css">
    

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    
    <link rel="stylesheet" href="css/custom.css">
    

    
</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "lfe-pdp" : "lfe-pdp";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');

            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }

            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('lfe-pdp')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item affix "><a href="index.html">LFE MACHINE MANUAL</a></li><li class="chapter-item affix "><a href="fm/title-page.html">Title Page</a></li><li class="chapter-item affix "><a href="fm/copyright.html">Copyright</a></li><li class="spacer"></li><li class="chapter-item affix "><a href="preface/index.html">Preface</a></li><li class="chapter-item affix "><a href="preface/about-cover.html">About the Cover</a></li><li class="chapter-item affix "><a href="preface/dedication.html">Dedication</a></li><li class="chapter-item affix "><a href="preface/forward.html">Forward</a></li><li class="chapter-item affix "><a href="preface/acknowledgments.html">Acknowledgments</a></li><li class="spacer"></li><li class="chapter-item "><strong aria-hidden="true">1.</strong> Part I - Getting Started<a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part1/intro/index.html"><strong aria-hidden="true">1.1.</strong> Introduction</a></li><li class="chapter-item "><a href="part1/intro/prereq.html"><strong aria-hidden="true">1.2.</strong> Prerequisites</a></li><li class="chapter-item "><a href="part1/intro/conventions.html"><strong aria-hidden="true">1.3.</strong> Conventions</a></li><li class="chapter-item "><a href="part1/intro/setup.html"><strong aria-hidden="true">1.4.</strong> Development Setup</a></li><li class="chapter-item "><a href="part1/intro/hw/index.html"><strong aria-hidden="true">1.5.</strong> 'Hello, World!'</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part1/intro/hw/repl.html"><strong aria-hidden="true">1.5.1.</strong> Classic, REPL</a></li><li class="chapter-item "><a href="part1/intro/hw/main.html"><strong aria-hidden="true">1.5.2.</strong> Classic, main</a></li><li class="chapter-item "><a href="part1/intro/hw/otp.html"><strong aria-hidden="true">1.5.3.</strong> LFE/OTP</a></li></ol></li><li class="chapter-item "><a href="part1/intro/guessing-game/index.html"><strong aria-hidden="true">1.6.</strong> Walk-through: An LFE Guessing Game</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part1/intro/guessing-game/planning.html"><strong aria-hidden="true">1.6.1.</strong> Planning the Game</a></li><li class="chapter-item "><a href="part1/intro/guessing-game/code.html"><strong aria-hidden="true">1.6.2.</strong> Code Explore</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part1/intro/guessing-game/input.html"><strong aria-hidden="true">1.6.2.1.</strong> Getting User Input</a></li><li class="chapter-item "><a href="part1/intro/guessing-game/check.html"><strong aria-hidden="true">1.6.2.2.</strong> Checking the Input</a></li></ol></li><li class="chapter-item "><a href="part1/intro/guessing-game/integrate.html"><strong aria-hidden="true">1.6.3.</strong> Integrating into an Application</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part1/intro/guessing-game/cast.html"><strong aria-hidden="true">1.6.3.1.</strong> handle_cast</a></li><li class="chapter-item "><a href="part1/intro/guessing-game/api.html"><strong aria-hidden="true">1.6.3.2.</strong> Game API</a></li><li class="chapter-item "><a href="part1/intro/guessing-game/finishing-touches.html"><strong aria-hidden="true">1.6.3.3.</strong> Finishing Touches</a></li><li class="chapter-item "><a href="part1/intro/guessing-game/play.html"><strong aria-hidden="true">1.6.3.4.</strong> Plyaign the Game</a></li></ol></li></ol></li></ol></li><li class="chapter-item "><strong aria-hidden="true">2.</strong> Part II - Code as Data<a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part2/data-types/index.html"><strong aria-hidden="true">2.1.</strong> Primitive Types</a></li><li class="chapter-item "><a href="part2/patterns/index.html"><strong aria-hidden="true">2.2.</strong> Pattern Matching</a></li><li class="chapter-item "><a href="part2/mani-list/index.html"><strong aria-hidden="true">2.3.</strong> Manipulating List Structure</a></li><li class="chapter-item "><a href="part2/symbols/index.html"><strong aria-hidden="true">2.4.</strong> Symbols</a></li><li class="chapter-item "><a href="part2/numbers/index.html"><strong aria-hidden="true">2.5.</strong> Numbers</a></li><li class="chapter-item "><a href="part2/arrays/index.html"><strong aria-hidden="true">2.6.</strong> Arrays</a></li><li class="chapter-item "><a href="part2/dicts/index.html"><strong aria-hidden="true">2.7.</strong> Dicts</a></li><li class="chapter-item "><a href="part2/records/index.html"><strong aria-hidden="true">2.8.</strong> Records</a></li><li class="chapter-item "><a href="part2/gen-seq/index.html"><strong aria-hidden="true">2.9.</strong> Generic Sequence Functions</a></li><li class="chapter-item "><a href="part2/chr-str/index.html"><strong aria-hidden="true">2.10.</strong> Characters and Strings</a></li><li class="chapter-item "><a href="part2/byte-bin/index.html"><strong aria-hidden="true">2.11.</strong> Bytes and Binaries</a></li></ol></li><li class="chapter-item "><strong aria-hidden="true">3.</strong> Part III - Data as Code<a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part3/funs/index.html"><strong aria-hidden="true">3.1.</strong> Functions</a></li><li class="chapter-item "><a href="part3/closures/index.html"><strong aria-hidden="true">3.2.</strong> Closures</a></li><li class="chapter-item "><a href="part3/eval/index.html"><strong aria-hidden="true">3.3.</strong> Evaluation</a></li><li class="chapter-item "><a href="part3/expressioins/index.html"><strong aria-hidden="true">3.4.</strong> Expressions</a></li><li class="chapter-item "><a href="part3/processes/index.html"><strong aria-hidden="true">3.5.</strong> Processes</a></li><li class="chapter-item "><a href="part3/msgs/index.html"><strong aria-hidden="true">3.6.</strong> Messages and Their Passing</a></li><li class="chapter-item "><a href="part3/objects/index.html"><strong aria-hidden="true">3.7.</strong> Objects and Flavors</a></li><li class="chapter-item "><a href="part3/io/index.html"><strong aria-hidden="true">3.8.</strong> I/O</a></li><li class="chapter-item "><a href="part3/files/index.html"><strong aria-hidden="true">3.9.</strong> Accessing Files</a></li><li class="chapter-item "><a href="part3/modules/index.html"><strong aria-hidden="true">3.10.</strong> Modules</a></li><li class="chapter-item "><a href="part3/packages/index.html"><strong aria-hidden="true">3.11.</strong> Packages</a></li><li class="chapter-item "><a href="part3/scripting/index.html"><strong aria-hidden="true">3.12.</strong> Scripting with LFE</a></li></ol></li><li class="chapter-item "><strong aria-hidden="true">4.</strong> Part IV - Advanced Topics<a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part4/err-debug/index.html"><strong aria-hidden="true">4.1.</strong> Errors and Debugging</a></li><li class="chapter-item "><a href="part4/unit/index.html"><strong aria-hidden="true">4.2.</strong> Writing Unit Tests</a></li><li class="chapter-item "><a href="part4/ct/index.html"><strong aria-hidden="true">4.3.</strong> The Common Test Framework</a></li><li class="chapter-item "><a href="part4/propr/index.html"><strong aria-hidden="true">4.4.</strong> The Propr Test Framework</a></li><li class="chapter-item "><a href="part4/compiler/index.html"><strong aria-hidden="true">4.5.</strong> The Compiler</a></li><li class="chapter-item "><a href="part4/macros/index.html"><strong aria-hidden="true">4.6.</strong> Macros</a></li><li class="chapter-item "><a href="part4/dist/index.html"><strong aria-hidden="true">4.7.</strong> Distributed LFE</a></li><li class="chapter-item "><a href="part4/ports/REAEDME.html"><strong aria-hidden="true">4.8.</strong> Ports and Port Drivers</a></li><li class="chapter-item "><a href="part4/servers/REAEDME.html"><strong aria-hidden="true">4.9.</strong> Servers</a></li><li class="chapter-item "><a href="part4/clients/REAEDME.html"><strong aria-hidden="true">4.10.</strong> Clients</a></li></ol></li><li class="chapter-item "><strong aria-hidden="true">5.</strong> Part V - OTP<a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part5/behaviours/index.html"><strong aria-hidden="true">5.1.</strong> Behaviours</a></li><li class="chapter-item "><a href="part5/apps/index.html"><strong aria-hidden="true">5.2.</strong> Applications</a></li><li class="chapter-item "><a href="part5/rels/index.html"><strong aria-hidden="true">5.3.</strong> Releases</a></li><li class="chapter-item "><a href="part5/data/index.html"><strong aria-hidden="true">5.4.</strong> Tables and Databases</a></li><li class="chapter-item "><a href="part5/project/index.html"><strong aria-hidden="true">5.5.</strong> Example OTP Project</a></li></ol></li><li class="chapter-item "><strong aria-hidden="true">6.</strong> Part VI - Conclusion<a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="part6/epilogue.html"><strong aria-hidden="true">6.1.</strong> Epilogue</a></li><li class="chapter-item "><a href="part6/afterward.html"><strong aria-hidden="true">6.2.</strong> Afterword</a></li><li class="spacer"></li></ol></li><li class="chapter-item "><a href="epilogue/glossary.html">Glossary</a></li><li class="chapter-item affix "><a href="epilogue/bibliography.html">Bibliography</a></li><li class="chapter-item affix "><a href="epilogue/index.html">Index</a></li><li class="spacer"></li><li class="chapter-item affix ">Appendices</li><li class="chapter-item affix "><a href="appendices/lisp-history.html">I - Origins Of Lisp</a></li><li class="chapter-item affix "><a href="appendices/erlang-history.html">II - Origins Of Erlang</a></li><li class="chapter-item affix "><a href="appendices/lfe-overview.html">III - Origins Of LFE</a></li><li class="spacer"></li><li class="chapter-item affix "><a href="feedback.html">Feedback</a></li><li class="chapter-item affix "><a href="redirects/docs.html">LFE Documentation</a></li><li class="chapter-item affix "><a href="redirects/rebar3.html">LFE rebar3 Plugin</a></li><li class="chapter-item affix "><a href="redirects/mdbook.html">Built with mdBook</a></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
            
            <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme"
                                id="lfe-pdp">LFE PDP</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="light">Light</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                    
                </div>

                <h1 class="menu-title">LFE MACHINE MANUAL</h1>

                <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    
                    <a href="https://github.com/cnbbooks/lfe-manual" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    
                </div>
            </div>

            
            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                        placeholder="Search this book ..." aria-controls="searchresults-outer"
                        aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>
            

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <main>
                    <p><a href="images/cover-large.jpg"><img src="images/cover.jpg" alt="" /></a></p>
<!-- Named page links below: /-->
<h1><a class="header" href="#lfe-machine-manual" id="lfe-machine-manual">LFE MACHINE MANUAL</a></h1>
<br/>
<br/>
<br/>
<br/>
<br/>
<p>Adatped from multiple sources
<br/>
by Duncan McGreggor and Robert Virding</p>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<p><a href="http://cnbb.pub/"><img src="fm/../images/cnbb-pub-logo-1.6.png" alt="publisher logo" /></a></p>
<!-- Named page links below: /-->
<p>Published by Cowboys 'N' Beans Books</p>
<p><a href="https://github.com/cnbbooks">https://github.com/cnbbooks</a> ◈ <a href="http://cnbb.pub/">http://cnbb.pub/</a> ◈ <a href="mailto:info@cnbb.pub">info@cnbb.pub</a></p>
<br/>
<br/>
<br/>
<p>First electronic edition published: 2020</p>
<br/>
<br/>
<br/>
<p>Portions © 1974, David Moon</p>
<p>Portions © 1978-1981, Daniel Weinreb and David Moon</p>
<p>Portions © 1979-1984, Douglas Adams</p>
<p>Portions © 1983, Kent Pitman</p>
<p>Portions © 1992-1993, Peter Norvig and Kent Pitman</p>
<p>Portions © 2003-2020, Ericsson AB</p>
<p>Portions © 2008-2012, Robert Virding</p>
<p>Portions © 2010-2020, Steve Klabnik and Carol Nichols</p>
<p>Portions © 2013-2020, Robert Virding and Duncan McGreggor</p>
<p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></p>
<p><a href="http://creativecommons.org/licenses/by-sa/4.0/"><img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="Creative Commons License" /></a></p>
<br/>
<br/>
<br/>
<h1><a class="header" href="#preface" id="preface">Preface</a></h1>
<p>The original Lisp Machine Manual, the direct spiritiaul ancestor of the LFE Machine Manual, described both the language and the &quot;operating system&quot; of the Lisp Machine. The language was a dialect of Lisp called Zetalisp. Zetalisp was a direct descendant of MACLISP, created as a systems programming language for the MIT Lisp machines. This is of special note since Erlang was created as a systems programming language too. One of it's co-creators, Robert Virding, created Lisp Flavoured Erlang (LFE) based upon his expereinces with Franz Lisp (which based largely upon MACLISP), Portable Standard Lisp (itself an experiment in systems programming), and ultimately in an implementation he made of Lisp Machine Flavors on top of VAX/VMS where he extensively utilized the Lisp Machine Manual.</p>
<p>As such, LFE has a very strong inheritance of systems programming from both parents, as it were. First and foremost, it is a BEAM language written on top of the Erlang VM and from which it strays very little. Secondly, it is a Lisp dialect. It is, however, <em>entirely</em> a systems programming language.</p>
<p>Which brings us back to Zetalisp and the Lisp Machine Manual. It seemed only fitting to base the LFE manual upon the fantastic work and docuentation that was done on Lisp systems programming in the 70s and 80s, work that so many of us treasure and adore and to which we still defer. Thus the machine that is OTP in the context and syntax of the LFE Lisp dialect is extensively documented in the LFE MACHINE MANUAL.</p>
<h1><a class="header" href="#about-the-cover" id="about-the-cover">About the Cover</a></h1>
<p>The LFE &quot;Chineual&quot; cover is based upon the Lisp Machine Manual covers of the early 80s. The Lisp Machine Manual editions we have seen from 1977 and 1979 had only hand-typed title pages, no covers, so we're not sure if the famous graphic/typographic design occurred any earlier than 1982. We've also been unable to discover who the original designer was, but would love to give them credit, should we find out.</p>
<h2><a class="header" href="#the-original" id="the-original">The Original</a></h2>
<p>The Software Preservation Group has this image on their site:</p>
<p><a href="http://www.softwarepreservation.org/projects/LISP/images/LispMachineManual.gif/view"><img src="preface/../images/chinuel-cover-bw.png" alt="" /></a></p>
<p>Bitsavers has a 3rd edition of the Chineual with the full cover</p>
<p><a href="http://www.bitsavers.org/pdf/mit/cadr/chinual_3rdEd_Mar81.pdf"><img src="preface/../images//chinuel-cover-full-color.png" alt="" /></a></p>
<h2><a class="header" href="#the-lfe-edition" id="the-lfe-edition">The LFE Edition</a></h2>
<h3><a class="header" href="#whole-cover" id="whole-cover">Whole Cover</a></h3>
<p><a href="preface/../images/cover-all-large.jpg"><img src="preface/../images/cover-all.jpg" alt="" /></a></p>
<h3><a class="header" href="#back-cover" id="back-cover">Back Cover</a></h3>
<p><a href="preface/../images/cover-back-large.jpg"><img src="preface/../images/cover-back.jpg" alt="" /></a></p>
<h3><a class="header" href="#the-spine" id="the-spine">The Spine</a></h3>
<p><a href="preface/../images/cover-binding-large.jpg"><img src="preface/../images/cover-binding.jpg" alt="" /></a></p>
<!-- Named page links below: /-->
<h1><a class="header" href="#dedication" id="dedication">Dedication</a></h1>
<p>TBD</p>
<h1><a class="header" href="#forward" id="forward">Forward</a></h1>
<p>TBD</p>
<h1><a class="header" href="#acknowledgments" id="acknowledgments">Acknowledgments</a></h1>
<p>TBD</p>
<p>[gonna be a long list ...]</p>
<h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>Far out in the uncharted backwaters of the unfashionable end of computer science known as &quot;distributed systems programming&quot; lies a small red <em>e</em>. Orbitting this at a distance roughly proportional to the inverse of the likelihood of it being noticed is an utterly insignificant little green mug filled with the morning beverage stimulant equivalent of That Old Janx Spirit. Upon that liquid floats a little yellow <em>𝛌</em> whose adherents are so amazingly primitive that they still think <code>cons</code>s, <code>car</code>, and <code>cdr</code> are pretty neat ideas.</p>
<p>This is their book.</p>
<p>Their language, Lisp Flavoured Erlang (henceforth &quot;LFE&quot;), lets you use the archaic and much-beloved S-expressions to write some of the most advanced software on the planet. LFE is a general-purpose, concurrent, functional Lisp whose underlying virtual machine (Erlang) was designed to create distributed, fault-tolerant, soft-realtime, highly-availale, always-up, hot-swappable appliances, applications, and services. In addition to fashionable digital watches, LFE sports immutable data, pattern-matching, eager evaluation, and dynamic typing.</p>
<p>This manual will not only teach you what all of that means and why you want it in your breakfast cereal, but also: how to create LFE programs; what exactly are the basic elements of the language; the ins-and-outs of extremely efficient and beautiful clients and servers; and much, much more.</p>
<p>Note, however, that the first chapter is a little different than most other books, and is in fact different from the rest of the chapters in this manual. We wrote this chapter with two guiding thoughts: firstly and foremost, we wanted to provide some practical examples of code-in-action as a context in which a programmer new to LFE could continuously refer -- from the very beginning through to the successful end --  while learning the general principles of that language; secondly, most programming language manuals are dry references to individual pieces of a language or system, not representatives of the whole, and we wanted to provide a starting place for those who learn well via examples, who <em>would</em> benefit from a view toward that whole. For those who have already seen plenty of LFE examples, don't need this, and would rather get to down to the nitty-gritty, rest assured we desire your experience to be guilt-free and thus encourage you to jump into next chapter immediately!</p>
<p>This book is divided into 6 parts with the following foci:</p>
<ul>
<li>Introductory material</li>
<li>Core data types and capabilities</li>
<li>The basics of LFE code and projects</li>
<li>Advanced language features</li>
<li>The machine that is OTP</li>
<li>Concluding thoughts and summaries</li>
</ul>
<p>There is a lot of material in this book, so just take it section by section. If at any time you feel overwhelmed, simply set down the book, take a deep breath, fix yourself a cuppa, and don't panic.</p>
<p>Welcome to the LFE MACHINE MANUAL, the definitive LFE reference.</p>
<h1><a class="header" href="#prerequisites" id="prerequisites">Prerequisites</a></h1>
<p>Anyone coming to LFE should have experience programming in another language, ideally a systems programming language, especially if that language was found lacking. If the corageous reader is attmping to use LFE as a means of entering the study of computer science, we might offer several <em>other</em> paths of study which may bear fruit more quickly and with less pain.</p>
<p>No prior Lisp experience is required, but that would certinaly be helpful. The same goes for Erlang/OTP (or any of the suite of BEAM languages). The reader with experience writing concurrent applications, wrestling with fault-tolerance, or maintaining highly-available applications and services does receive bonus points for preparedness. Such well-prepared readers landing here may have, in fact, done so due to a quest for a distributed Lisp. For those whom this does apply, your quest has found its happy end.</p>
<p>This book assumes the reader has the following installed upon their system:</p>
<ul>
<li>a package manager for easily installing software (in particular, development tools and supporting libraries)</li>
<li><code>git</code>, <code>make</code>, and other core open source software development tools</li>
<li>a modern version of Erlang (as of the writing of this book, that would include versions 19 through 23); the rebar3 documentation has <a href="https://www.rebar3.org/docs/getting-started#installing-erlang">great suggestions</a> on what to use here, depending upon your need</li>
<li>the <code>rebar3</code> build tool for Erlang (and other BEAM languages); see <a href="https://www.rebar3.org/docs/getting-started#installing-binary">its docs</a> for installation instructions</li>
</ul>
<h1><a class="header" href="#conventions" id="conventions">Conventions</a></h1>
<h2><a class="header" href="#typography" id="typography">Typography</a></h2>
<h3><a class="header" href="#key-entry" id="key-entry">Key Entry</a></h3>
<p>We use the angle bracket convention to indicated typing actual key entries on the keyboard. For instance, when the reader sees <code>&lt;ENTER&gt;</code> they should interpret this as an actual key they should type. That that all keys are given in upper-case. If the reader is expected to use an upper-case &quot;C&quot;  rather than a lower-case &quot;c&quot;, they will be presented with the key combination <code>&lt;SHIFT&gt;&lt;C&gt;</code>.</p>
<h3><a class="header" href="#code" id="code">Code</a></h3>
<p>Color syntax highlighting is used in this text to display blocks of code. The formatting of this display is done in such a way as to invoke in the mind of the reader the feeling of a terminal, thus making an obvious visual distinction in the text. For instance:</p>
<pre><code class="language-lisp">(defun fib
  ((0) 0)
  ((1) 1)
  ((n)
    (+ (fib (- n 1))
       (fib (- n 2)))))
</code></pre>
<p>Examples such as this one are readily copied and may be pasted without edit into a file or even the LFE REPL itself.</p>
<p>For interactive code, we display the default LFE prompt the reader will see when in the REPL. We also separate out input and output into separate code blocks. For example:</p>
<pre><code class="language-lisp">lfe&gt; (integer_to_list 42 2)
</code></pre>
<pre><code class="language-lisp">&quot;101010&quot;
</code></pre>
<p>Note, however, that due to the inclusion of the <code>lfe&gt;</code> prompt, care must be taken when copying and pasting these examples. If you copy these, you will almost certainly want to edit the pasted text to remove the prompt.</p>
<h2><a class="header" href="#liffybot" id="liffybot">LiffyBot</a></h2>
<p><img class="liffy-bot-mascot" src="part1/intro/../../images/LiffyBot-5-x500-bold-color.png"/>This is a severly hoopy frood. With an attitude. He pops up from time to time, generally with good advice. </p>
<br/>
<h2><a class="header" href="#messages-of-note" id="messages-of-note">Messages of Note</a></h2>
<p>From time to time you will see call-out boxes, aimed at drawing your attention to something of note. There are four differnt types of these:</p>
<ul>
<li>ones that share useful info (blue)</li>
<li>ones that highlight something of a momentus nature (green)</li>
<li>ones that offer warnings to tred carefully (orange)</li>
<li>ones that beg you not to follow a particular path (red)</li>
</ul>
<p>These messages will take the following forms:</p>
<div class="alert alert-info">
  <h4 class="alert-heading">
    <i class="fa fa-info-circle" aria-hidden="true"></i>
    Information
  </h4>
  <p class="mb-0">
    Here you will see a message of general interest that could have a useful or even positive impact on your experience in programming LFE.
<p>The icon associated with this type of message is the &quot;i&quot; in a circle.</p>
</p>
</div>
<br/>
<div class="alert alert-success">
  <h4 class="alert-heading">
    <img class="liffy-bot-alert" src="part1/intro/../../images/LiffyBot-5-x64-bold-black-solid.png"/>
    Amazing!
  </h4>
  <p class="mb-0">
    Here you will see a message of general celebration for sitations that warrant it, above and beyond the general celebration you will feel writing programs in a distributed Lisp.
<p>The icon assocated with this type of message is that of LiffyBot.</p>
</p>
</div>
<br/>
<div class="alert alert-warning">
  <h4 class="alert-heading">
    <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
    Warning!
  </h4>
  <p class="mb-0">
    Here you will see a message indicating a known isssue or practice you should avoid if possible.
<p>The icon assocated with this type of message is the &quot;!&quot; in a caution triangle.</p>
</p>
</div>
<br/>
<div class="alert alert-danger">
  <h4 class="alert-heading">
    <i class="fa fa-minus-circle" aria-hidden="true"></i>
    Danger!
  </h4>
  <p class="mb-0">
    Here you will see a message indicating something that could endanger the proper function of an LFE system or threaten the very existence of the universe itself.
<p>The icon assocated with this type of message is &quot;do not enter&quot;.</p>
</p>
</div>
<h1><a class="header" href="#development-setup" id="development-setup">Development Setup</a></h1>
<h2><a class="header" href="#rebar3-configuration" id="rebar3-configuration"><code>rebar3</code> Configuration</a></h2>
<p>Having followed the notes and linked instructions in the <a href="part1/intro/prereq.html">Prerequisites</a> section, you are ready to add global support for the LFE <code>rebar3</code> plugin.</p>
<p>First, unless you have configured other <code>rebar3</code> plugins on your system, you will need to create the configuration directory and the configuration file:</p>
<pre><code class="language-shell">mkdir ~/.config/rebar3
touch ~/.config/rebar3/rebar.config
</code></pre>
<p>Next, open up that file in your favourite editor, and give it these contents:</p>
<pre><code class="language-erlang">{plugins, [
  {rebar3_lfe,
    {git, &quot;https://github.com/lfe-rebar3/rebar3_lfe.git&quot;, {branch, &quot;master&quot;}}}
]}.
</code></pre>
<p>If you already have a <code>rebar.config</code> file with a plugins entry, then simply add a comma after the last plugin listed and paste the <code>{rebar3_lfe, {...}}</code> line from above (with no trailing comma!).</p>
<div class="alert alert-warning">
  <h4 class="alert-heading">
    <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
    For Windows users
  </h4>
  <p class="mb-0">
    XXX
  </p>
</div>
<div class="alert alert-info">
  <h4 class="alert-heading">
    <i class="fa fa-info-circle" aria-hidden="true"></i>
    For Windows users
  </h4>
  <p class="mb-0">Some notes on compatibility:</p>
  <p class="mb-0">
    While LFE, Erlang, and <code>rebar3</code> work on *NIX, BSD, and Windows systems, much of the development the community does occurs predominently on the first two and sometimes Windows support is spotty and less smooth than on the more used platforms (this is more true for <code>rebar3</code> and LFE, and _most_ true for LFE).
<p>In particular, starting a REPL in Windows can take a little more effort (an extra step or two) than it does on, for example, Linux and Mac OS X machines.</p>
</p>
</div>
<h2><a class="header" href="#a-quick-test-with-the-repl" id="a-quick-test-with-the-repl">A Quick Test with the REPL</a></h2>
<p>With the LFE <code>rebar3</code> plugin successfully configured, you should be able to start up the LFE REPL anywhere on your system with the following:</p>
<pre><code class="language-shell">rebar3 lfe repl
</code></pre>
<pre><code class="language-text">Erlang/OTP 23 [erts-11.0] [source] [64-bit] [smp:16:16] [ds:16:16:10] [async-threads:1] [hipe]

   ..-~.~_~---..
  (      \\     )    |   A Lisp-2+ on the Erlang VM
  |`-.._/_\\_.-':    |   Type (help) for usage info.
  |         g |_ \   |
  |        n    | |  |   Docs: http://docs.lfe.io/
  |       a    / /   |   Source: http://github.com/rvirding/lfe
   \     l    |_/    |
    \   r     /      |   LFE v1.3-dev (abort with ^G)
     `-E___.-'

lfe&gt;
</code></pre>
<p>Exit out of the REPL for now with the <code>&lt;CTRL&gt;&lt;G&gt;</code> and then <code>&lt;CTRL&gt;&lt;C&gt;</code> key combinations.</p>
<div class="alert alert-warning">
  <h4 class="alert-heading">
    <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
    For Windows users
  </h4>
  <p class="mb-0">
    On Windows, this currently puts you into the Erlang shell, not the LFE REPL. To continue to the LFE REPL, you will need to enter <code>lfe_shell:server().</code> and then press <code>&lt;ENTER&gt;</code>.
  </p>
</div>
<h1><a class="header" href="#hello-world" id="hello-world">'Hello, World!'</a></h1>
<p>Hello-World style introductory programs are intended to give the potential programmer for that language a sense of what it is like to write a minimalist piece of software with the language in question. In particular, it should show off the minimum capabilitiues of the language, essentially, what you could be in for should you decide upon this path.</p>
<p>In the case of LFE/OTP, this is extremely misleading. But more on that in the OTP version of the Hello-World program.</p>
<p>In this section we will concede to conventional practice and produce a minimal Hello-World that does what many other languages' Hello-World programs do.</p>
<h1><a class="header" href="#from-the-repl" id="from-the-repl">From the REPL</a></h1>
<p>As previously demonstrated, it is possible to start up the LFE read-eval-print-loop (REPL) using <code>rebar3</code>:</p>
<pre><code class="language-shell">rebar3 lfe repl
</code></pre>
<p>Once you are at the LFE prompt, you may write a simple LFE &quot;program&quot; like the following:</p>
<pre><code class="language-lisp">lfe&gt; (io:format &quot;~p~n&quot; (list &quot;Hello, World!&quot;))
</code></pre>
<p>Or, for the terminally lazy:</p>
<pre><code class="language-lisp">lfe&gt; (io:format &quot;~p~n&quot; '(&quot;Hello, World!&quot;))
</code></pre>
<p>While technically a program, it is not very interesting; we didn't create a function of our own, nor did we run it from outside the LFE interactive programming environment. Let's address one of those points right now.</p>
<p>Try this, instead:</p>
<pre><code class="language-lisp">lfe&gt; (defun hello-world ()
       (io:format &quot;~p~n&quot; '(&quot;Hello, World!&quot;)))
</code></pre>
<p>This is a simple function definition in LFE.</p>
<p>We can run it by calling it:</p>
<pre><code class="language-lisp">lfe&gt; (hello-world)
</code></pre>
<pre><code class="language-text">&quot;Hello, World!&quot;
ok
</code></pre>
<p>When we execute our <code>hello-world</code> function, it prints our message to <code>standar-output</code> and then let's us know everything really quite fine. LFE displays <code>ok</code> as output for functions that do not return a value.</p>
<p>Now let's address the other point: running a Hello-World programming from outside LFE.</p>
<p>Hit <code>&lt;CTRL-G&gt;&lt;CTRL-C&gt;</code> to exit the REPL and get back to your terminal.</p>
<h1><a class="header" href="#from-the-command-line" id="from-the-command-line">From the Command Line</a></h1>
<p>From your system shell prompt, run the following to create a new project that will let us run a Hello-World program from the command line:</p>
<pre><code class="language-shell">rebar3 new lfe-main hello-world
cd ./hello-world
</code></pre>
<p>Once in the project directory, you can actually just do this:</p>
<pre><code class="language-shell">rebar3 lfe run
</code></pre>
<p>You will see code getting downloaded and compiled, and then your script will run, generating the following output:</p>
<pre><code class="language-text">Running script '/usr/local/bin/rebar3' with args [] ...
'hello-world
</code></pre>
<p>When you created a new LFE project of type 'main', a Hello-World function was automatically generated for you, one that's even simpler than what we created in the previous section:</p>
<pre><code class="language-lisp">(defun my-fun ()
  'hello-world)
</code></pre>
<p>The other code that was created when we executed <code>rebar3 new lfe-main hello-world</code> was a script meant to be used by LFE with LFE acting as a shell interpreter:</p>
<pre><code class="language-lisp">#!/usr/bin/env lfescript

(defun main (args)
  (let ((script-name (escript:script_name)))
    (io:format &quot;Running script '~s' with args ~p ...~n&quot; `(,script-name ,args))
    (io:format &quot;~p~n&quot; `(,(hello-world:my-fun)))))
</code></pre>
<p>You may be wondering about the <code>args</code> argument to the <code>main</code> function, and the fact that the printed output for the <code>args</code> when we ran this was <code>[]</code>. Let's try something:</p>
<pre><code class="language-shell">rebar3 lfe run -- Fenchurch 42
</code></pre>
<pre><code class="language-text">Running script '/usr/local/bin/rebar3' with args [&lt;&lt;&quot;Fenchurch&quot;&gt;&gt;,&lt;&lt;&quot;42&quot;&gt;&gt;] ...
'hello-world'
</code></pre>
<p>We have to provide the two dashes to let <code>rebar3</code> know that we're done with it, that the follow argsuments are not for it, but rather for the program we want it to start for us. So it passes everything after the <code>--</code> to our script.</p>
<p>As for the code itself, it's tiny. But there is a lot going on just with these two files. HAve no fear, though: the remainder of this book will explore all of that and more. For now, know that the main function in the executable is calling the <code>hello-world</code> module's <code>my-fun</code> function, which takes no arguments. To put another way, what we really have here is a tiny, trivial library project with the addition of a script that calls a function from that library.</p>
<p>For know just know that an executable file which starts with <code>#!/usr/bin/env lfescript</code> and contains a <code>main</code> function accepting one argument is an LFE script capable of being executed from the command line -- a we have shown!</p>
<h1><a class="header" href="#lfeotp-hello-world" id="lfeotp-hello-world">LFE/OTP 'Hello, World!'</a></h1>
<p>What has been demonstrated so far is a fairly vanilla Hello-World; there's nothing particularly interesting about it, just like any other Hello-World program. As mentioned before, this is particularly tricking in the case of LFE/OTP, since it lures the prospective developer into the preconception that BEAM languages are just like other programming languages, and they are not.</p>
<p>What makes them, and in this particular case LFE, special is OTP. There's really nothing quite like it, certainly not baked into the heart and soul of another programming language. Most useful applications you will write in LFE/OTP will be composed of some sort of long-running service or server, something that manages that server and restarts it in the event of errors, and lastly, a context that contains both referred to as the &quot;application&quot; itself.</p>
<p>As such, a <em>real</em> Hello-World in LFE would be honest and let the prospective developer know what they are info (and what power will be placed at their fingertips). And that is what we will show now.</p>
<p>If you are still in the directory of the previous Hello-World project, let's get out of that:</p>
<pre><code class="language-shell">cd ../
</code></pre>
<p>Now we're going to create a new project, one utilising the some very basic OTP patterns:</p>
<pre><code class="language-shell">rebar3 new lfe-app hello-otp-world
cd ./hello-otp-world
</code></pre>
<p>We won't look at the code for this right now, since there are chapters dedicated to that in the second half of the book. But let's brush the surface with a quick run in the REPL:</p>
<pre><code class="language-shell">rebar3 lfe repl
</code></pre>
<p>To start your new hello-world application, use the OTP <code>application</code> module:</p>
<pre><code class="language-lisp">lfe&gt; (application:ensure_all_started 'hello-otp-world)
</code></pre>
<pre><code class="language-lisp">#(ok (hello-otp-world))
</code></pre>
<p>That message lets you know that not only was the <code>hello-otp-word</code> application and server started without issue, any applications upon which it depends were also started. Furthermore, there is a supervisor for our server, and it has started as well. Should our Hello-World server crash for any reason, the supervisor will restart it.</p>
<p>To finish the demonstration, and display the clichéd if classic message:</p>
<pre><code class="language-lisp">(hello-otp-world:echo &quot;Hello, OTP World!&quot;)
</code></pre>
<pre><code class="language-lisp">&quot;Hello, OTP World!&quot;
</code></pre>
<p>And that, dear reader, is a <em>true</em> LFE/OTP Hello-World program, complete with message-passing and pattern-matching!</p>
<p>Feel free to poke around in the code that was generated for you, but know that eventually all its mysteries will be revealed, and by the end of this book this program's magic will just seem like ordinary code to you, ordinary, dependable, fault-tolerant, highly-availble, massively-concurrent code.</p>
<h1><a class="header" href="#walk-through-an-lfe-guessing-game" id="walk-through-an-lfe-guessing-game">Walk-through: An LFE Guessing Game</a></h1>
<p>Now that you've seen some LFE in action, let's do something completely insane: write a whole game before we even know the language!</p>
<p>We will follow the same patterns established in the Hello-World examples, so if you are still in one of the Hello-World projects, change directory and then create a new LFE project:</p>
<pre><code class="language-shell">cd ../
rebar3 new lfe-app guessing-game
cd ./guessing-game
</code></pre>
<p>We will create this game by exploring functions in the REPL and then saving the results in a file. Open up your generated project in your favourite code-editing application, and then open up a terminal from your new project directory, and start the REPL:</p>
<pre><code class="language-shell">rebar3 lfe repl
</code></pre>
<h1><a class="header" href="#planning-the-game" id="planning-the-game">Planning the Game</a></h1>
<p>We've created our new project, but before we write even a single atom of code, let's take a moment to think about the problem and come up with a nice solution. Byt doing this, we increase our chances of making something both useful and elegant. As long as what we write remains legible and meets our needs, the less we write the better. This sort of practice elegance will make the code easier to maintain and reduce the chance for bugs (by the simple merrit of there being less code in which a bug may arise; the more code, the greater opportunities for bugs).</p>
<p>Our first step will be making sure we understand the problem and devising some minimal abstractions. Next, we'll think about what actually need to happen in the game. With that in hand, we will know what state we need to track. Then, we're off to the races: all the code will fall right into place and we'll get to play our game.</p>
<h2><a class="header" href="#key-abstractions" id="key-abstractions">Key Abstractions</a></h2>
<p>In a guessing game, there are two players: one who has the answer, and one who seeks the answer. Our code and data should clearly model these two players.</p>
<h2><a class="header" href="#actions" id="actions">Actions</a></h2>
<p>The player with the answer needs to peform the following actions:</p>
<ol>
<li>At the beginning of the game, state the problem and tell the other player to start guessing</li>
<li>Receive the other player's guess</li>
<li>Check the guess against the answer</li>
<li>Report back to the other player on the provided guess</li>
<li>End the game if the guess was correct</li>
</ol>
<p>The guessing player needs to take only one action:</p>
<ol>
<li>guess!</li>
</ol>
<h2><a class="header" href="#state" id="state">State</a></h2>
<p>We need to track the state of the game. Based upon the actions we've examined, the overall state is very simple. Through the course of the game, will only need to preserve the answer that will be guessed.</p>
<h1><a class="header" href="#code-explore" id="code-explore">Code Explore</a></h1>
<p>Now that we've thought through our problem space clearly and cleanly, let's do some code exploration and start defining some functions we think we'll need.</p>
<p>We've already generated an OTP application using the LFE <code>rebar3</code> plugin, and once we've got our collection of functions that address the needed game features, we can plug those into the application.</p>
<p>We'll make those changes in the code editor you've opened, and we'll explore a small set of possible functions to use for this using the project REPL session you've just started.</p>
<h1><a class="header" href="#getting-user-input" id="getting-user-input">Getting User Input</a></h1>
<p>How do we get user input in LFE? Like this!</p>
<pre><code class="language-lisp">lfe&gt; (io:fread &quot;Guess number: &quot; &quot;~d&quot;)
</code></pre>
<p>This will print the prompt <code>Guess number:</code> and then await your input and the press of the <code>&lt;ENTER&gt;</code> key. The input you provide needs to match the format type given in the second argument. In this case, the <code>~d</code> tells us that this needs to be a decimal (base 10) integer.</p>
<pre><code class="language-lisp">fe&gt; (io:fread &quot;Guess number: &quot; &quot;~d&quot;)
</code></pre>
<pre><code class="language-lisp">Guess number: 42
#(ok &quot;*&quot;)
</code></pre>
<p>If we try typing something that is not a base 10 integer, we get an error:</p>
<pre><code class="language-lisp">lfe&gt; (io:fread &quot;Guess number: &quot; &quot;~d&quot;)
</code></pre>
<pre><code class="language-lisp">Guess number: forty-two
#(error #(fread integer))
</code></pre>
<p>With correct usage, how do we capture the value in a variable? The standard way to do this in LFE is destructuring via pattern matching. The following snippet extracts the value and then prints the extracted value in the REPL:</p>
<pre><code class="language-lisp">lfe&gt; (let ((`#(ok (,value)) (io:fread &quot;Guess number: &quot; &quot;~d&quot;)))
lfe&gt;   (io:format &quot;Got: ~p~n&quot; `(,value)))
</code></pre>
<pre><code class="language-text">Guess number: 42
Got: 42
ok
</code></pre>
<p>We'll talk a lot more about pattern matching in the future, as well as the meaning of the backtick and commas. For now,let's keep pottering in the REPL with these explorations, and make a function for this:</p>
<pre><code class="language-lisp">lfe&gt; (defun guess ()
lfe&gt;   (let ((`#(ok (,value)) (io:fread &quot;Guess number: &quot; &quot;~d&quot;)))
lfe&gt;     (io:format &quot;You guessed: ~p~n&quot; `(,value))))
</code></pre>
<p>And call it:</p>
<pre><code class="language-lisp">lfe&gt; (guess)
</code></pre>
<pre><code class="language-text">Guess number: 42
You guessed: 42
ok
</code></pre>
<h1><a class="header" href="#checking-the-input" id="checking-the-input">Checking the Input</a></h1>
<p>In LFE there are several ways in which you can perform checks on values:</p>
<ul>
<li>the <code>if</code> form</li>
<li>the <code>cond</code> form</li>
<li>the <code>case</code> form</li>
<li>pattern-matching and/or guards in function heads</li>
</ul>
<p>The last one is commonly used in LFE when passing messages / data between functions. Our initial, generated project code is already doing this, and given the game state data we will be working with, this feels like a good fit what we need to implement.</p>
<p>Normally records are used for application data, but since we just care about the value of two integers (the number selected for the answer and the number guessed by the player), we'll keep things simple in this game:</p>
<pre><code class="language-lisp">(set answer 42)
</code></pre>
<p>Let's create a function with a guard:</p>
<pre><code class="language-lisp">lfe&gt; (defun check
lfe&gt;   ((guess) (when (&lt; guess answer))
lfe&gt;    (io:format &quot;Guess is too low~n&quot;)))
</code></pre>
<pre><code class="language-lisp">lfe&gt; (check data)
Guess is too low
ok
</code></pre>
<p>The extra parenthesis around the function's arguments is due to the use of the pattern-matching form of function definition we're using here. We need this form, since we're going to use a guard. The <code>when</code> after the function args is called a &quot;guard&quot; in LFE. As you might imagine, we could use any number of these. Let's add some more:</p>
<pre><code class="language-lisp">lfe&gt; (defun check
lfe&gt;   ((guess) (when (&lt; guess answer))
lfe&gt;    (io:format &quot;Guess is too low~n&quot;))
lfe&gt;   ((guess) (when (&gt; guess answer))
lfe&gt;    (io:format &quot;Guess is too high~n&quot;))
lfe&gt;   ((guess) (when (== guess answer))
lfe&gt;    (io:format &quot;Correct!~n&quot;)))
</code></pre>
<pre><code class="language-lisp">lfe&gt; (check 10)
</code></pre>
<pre><code>Guess is too low
ok
</code></pre>
<pre><code class="language-lisp">lfe&gt; (check 100)
</code></pre>
<pre><code>Guess is too high
ok
</code></pre>
<pre><code class="language-lisp">lfe&gt; (check 42)
</code></pre>
<pre><code>Correct!
ok
</code></pre>
<p>This should give a very general sense of what is possible.</p>
<h1><a class="header" href="#integrating-into-an-application" id="integrating-into-an-application">Integrating into an Application</a></h1>
<p>You're only going to touch one of the files that was generated when you created the <code>guessing-game</code> project: <code>./src/guessing-game.lfe</code>. You can ignore all the others.</p>
<p>We need to reflect on the planning we just did, remembering the actions and states that we want to support. There's also another thing to consider, since we're writing this as is an always-up OTP app. With some adjustments for state magagement, it could easily be turned into something that literally millions of users could be accessing simultaneously (and not a single-user CLI example). As such, the server will need to be able to process the following messages:</p>
<ul>
<li><code>#(start-game true)</code> (create a record to track game state)</li>
<li><code>#(stop-game true)</code> (clear the game state)</li>
<li><code>#(guess n)</code>
<ul>
<li>check for guess equal to the answer</li>
<li>greater than the answer, and</li>
<li>less than the answer</li>
</ul>
</li>
</ul>
<p>We could have just used atoms for the first two, and done away with the complexity of using tuples for those, but symmetry is nice :-)</p>
<p>To create the game, we're going to need to perform the following integration tasks:</p>
<ul>
<li>Update the <code>handle_cast</code> function to process the commands and guards we listed above</li>
<li>Create API functions that cast the appropriate messages</li>
<li>Update the <code>export</code> form in the module definition</li>
<li>Set the random seed so that the answers are different every time you start the application</li>
</ul>
<h1><a class="header" href="#handle_cast" id="handle_cast"><code>handle_cast</code></a></h1>
<p>The biggest chunk of code that needs to be changed is the <code>handle_cast</code> function. Since our game doesn't return values, we'll be using <code>handle_cast</code>. (If we needed to have data or results returned to us in the REPL, we would have used <code>handle_call</code> instead. Note that both are standard OTP <code>gen_server</code> callback functions.)</p>
<p>The generated project barely populates this function, so there's a big code change here. In the file <code>./src/guessing-game.lfe</code>, change this:</p>
<pre><code class="language-lisp">(defun handle_cast (_msg state)
  `#(noreply ,state))
</code></pre>
<p>to this:</p>
<pre><code class="language-lisp">(defun handle_cast
  ((`#(start-game true) _state)
   (io:format &quot;Guess the number I have chosen, between 1 and 10.~n&quot;)
   `#(noreply ,(random:uniform 10)))
  ((`#(stop-game true) _state)
   (io:format &quot;Game over~n&quot;)
   '#(noreply undefined))
  ((`#(guess ,n) answer) (when (== n answer))
   (io:format &quot;Well-guessed!!~n&quot;)
   (stop-game)
   '#(noreply undefined))
  ((`#(guess ,n) answer) (when (&gt; n answer))
   (io:format &quot;Your guess is too high.~n&quot;)
   `#(noreply ,answer))
  ((`#(guess ,n) answer) (when (&lt; n answer))
   (io:format &quot;Your guess is too low.~n&quot;)
   `#(noreply ,answer))
  ((_msg state)
   `#(noreply ,state)))
</code></pre>
<p>Three patterns are matched here: start, stop and guess. There are three guess patterns since there are three different guards we want placed on them (even though the pattern for the guess data itself doesn't change). Finally, there's the original &quot;pass-through&quot; or &quot;match-any&quot; pattern (this is used to prevent an error in the event of an unexpected message type).</p>
<h1><a class="header" href="#game-api" id="game-api">Game API</a></h1>
<p>In order to send a message to a running OTP server, you use special OTP functions for the type of server you are running. Our game is running a <code>gen_server</code> so we'll be using use that OTP module to send messages.</p>
<p>Creating messages and sending them via the appropriate <code>gen_server</code> function can get tedious quickly, so it is common practice to create API functions that do these things for you.</p>
<p>In our case, we want to go to the section with the heading <code>;;; our server API</code> and add the following:</p>
<pre><code class="language-lisp">(defun start-game ()
  (gen_server:cast (SERVER) '#(start-game true)))

(defun stop-game ()
  (gen_server:cast (SERVER) '#(stop-game true)))

(defun guess (n)
  (gen_server:cast (SERVER) `#(guess ,n)))
</code></pre>
<p>We have added these functions, but they will not be usable outside the module, since functions in LFE are private by default. In order for other modules (or a user in the REPL) to use our functions, we need to export them.</p>
<p>Go to the top of the <code>guessing-game</code> module and change this:</p>
<pre><code class="language-lisp">(defmodule guessing-game
  (behaviour gen_server)
  (export
    ;; gen_server implementation
    (start_link 0)
    (stop 0)
    ;; callback implementation
    (init 1)
    (handle_call 3)
    (handle_cast 2)
    (handle_info 2)
    (terminate 2)
    (code_change 3)
    ;; server API
    (pid 0)
    (echo 1)))
</code></pre>
<p>to this:</p>
<pre><code class="language-lisp">(defmodule guessing-game
  (behaviour gen_server)
  (export
    ;; gen_server implementation
    (start_link 0)
    (stop 0)
    ;; callback implementation
    (init 1)
    (handle_call 3)
    (handle_cast 2)
    (handle_info 2)
    (terminate 2)
    (code_change 3)
    ;; server API
    (pid 0)
    (echo 1)
    (start-game 0)
    (stop-game 0)
    (guess 1)))
</code></pre>
<p>Now our game functions are public, and we'll be able to use them from the REPL.</p>
<h1><a class="header" href="#finishing-touches" id="finishing-touches">Finishing Touches</a></h1>
<p>There is one last thing we can do to make our game more interesting. Right now, the game will work. But every time we start up the REPL and kick off a new game, the same &quot;random&quot; number will be selected for the answer. In order to make things interesting, we need to generate a random seed when we initialize our server. You can do that by changing this:</p>
<pre><code class="language-lisp">(defun init (state)
  `#(ok ,state))
</code></pre>
<p>to this:</p>
<pre><code class="language-lisp">(defun init (state)
  (random:seed (erlang:phash2 `(,(node)))
               (erlang:monotonic_time)
               (erlang:unique_integer))
  `#(ok ,state))
</code></pre>
<h1><a class="header" href="#plyaign-the-game" id="plyaign-the-game">Plyaign the Game</a></h1>
<p>If you are still in the REPL, quit out of it so that <code>rebar3</code> can rebuild out changed module. Then start it up again:</p>
<pre><code class="language-shell">rebar3 lfe repl
</code></pre>
<p>Once at the LFE propmpt, start up the application:</p>
<pre><code class="language-lisp">lfe&gt; (application:ensure_all_started 'guessing-game)
</code></pre>
<p>With the application and all of its dependencies started, we're ready to start the game and play it through:</p>
<pre><code class="language-lisp">lfe&gt; (guessing-game:start-game)
</code></pre>
<pre><code>ok
Guess the number I have chosen, between 1 and 10.
</code></pre>
<pre><code class="language-lisp">lfe&gt; (guessing-game:guess 10)
</code></pre>
<pre><code>ok
Your guess is too high.
</code></pre>
<pre><code class="language-lisp">lfe&gt; (guessing-game:guess 1)
</code></pre>
<pre><code>ok
Your guess is too low.
</code></pre>
<pre><code class="language-lisp">lfe&gt; (guessing-game:guess 5)
</code></pre>
<pre><code>ok
Your guess is too low.
</code></pre>
<pre><code class="language-lisp">lfe&gt; (guessing-game:guess 7)
</code></pre>
<pre><code>ok
Your guess is too low.
</code></pre>
<pre><code class="language-lisp">lfe&gt; (guessing-game:guess 8)
</code></pre>
<pre><code>ok
Well-guessed!!
Game over
</code></pre>
<h1><a class="header" href="#primitive-types" id="primitive-types">Primitive Types</a></h1>
<h1><a class="header" href="#pattern-matching" id="pattern-matching">Pattern Matching</a></h1>
<h1><a class="header" href="#manipulating-list-structure" id="manipulating-list-structure">Manipulating List Structure</a></h1>
<h1><a class="header" href="#symbols" id="symbols">Symbols</a></h1>
<h1><a class="header" href="#numbers" id="numbers">Numbers</a></h1>
<h1><a class="header" href="#arrays" id="arrays">Arrays</a></h1>
<h1><a class="header" href="#dicts" id="dicts">Dicts</a></h1>
<h1><a class="header" href="#records" id="records">Records</a></h1>
<h1><a class="header" href="#generic-sequence-functions" id="generic-sequence-functions">Generic Sequence Functions</a></h1>
<h1><a class="header" href="#characters-and-strings" id="characters-and-strings">Characters and Strings</a></h1>
<h1><a class="header" href="#bytes-and-binaries" id="bytes-and-binaries">Bytes and Binaries</a></h1>
<h1><a class="header" href="#functions" id="functions">Functions</a></h1>
<h1><a class="header" href="#closures" id="closures">Closures</a></h1>
<h1><a class="header" href="#evaluation" id="evaluation">Evaluation</a></h1>
<h1><a class="header" href="#flow-of-control" id="flow-of-control">Flow of Control</a></h1>
<h1><a class="header" href="#processes" id="processes">Processes</a></h1>
<h1><a class="header" href="#messages-and-their-passing" id="messages-and-their-passing">Messages and Their Passing</a></h1>
<h1><a class="header" href="#objects-and-flavors" id="objects-and-flavors">Objects and Flavors</a></h1>
<h1><a class="header" href="#io" id="io">I/O</a></h1>
<h1><a class="header" href="#accessing-files" id="accessing-files">Accessing Files</a></h1>
<h1><a class="header" href="#modules" id="modules">Modules</a></h1>
<h1><a class="header" href="#packages" id="packages">Packages</a></h1>
<h1><a class="header" href="#scripting-with-lfe" id="scripting-with-lfe">Scripting with LFE</a></h1>
<h1><a class="header" href="#errors-and-debugging" id="errors-and-debugging">Errors and Debugging</a></h1>
<h1><a class="header" href="#writing-unit-tests" id="writing-unit-tests">Writing Unit Tests</a></h1>
<h1><a class="header" href="#the-common-test-framework" id="the-common-test-framework">The Common Test Framework</a></h1>
<h1><a class="header" href="#the-propr-test-framework" id="the-propr-test-framework">The Propr Test Framework</a></h1>
<h1><a class="header" href="#the-compiler" id="the-compiler">The Compiler</a></h1>
<h1><a class="header" href="#macros" id="macros">Macros</a></h1>
<h1><a class="header" href="#distributed-lfe" id="distributed-lfe">Distributed LFE</a></h1>
<h1><a class="header" href="#ports-and-port-drivers" id="ports-and-port-drivers">Ports and Port Drivers</a></h1>
<h1><a class="header" href="#servers" id="servers">Servers</a></h1>
<h1><a class="header" href="#clients" id="clients">Clients</a></h1>
<h1><a class="header" href="#otp-behaviours" id="otp-behaviours">OTP Behaviours</a></h1>
<h1><a class="header" href="#applications" id="applications">Applications</a></h1>
<h1><a class="header" href="#releases" id="releases">Releases</a></h1>
<h1><a class="header" href="#tables-and-databases" id="tables-and-databases">Tables and Databases</a></h1>
<h1><a class="header" href="#example-otp-project" id="example-otp-project">Example OTP Project</a></h1>
<h1><a class="header" href="#epilogue" id="epilogue">Epilogue</a></h1>
<h1><a class="header" href="#afterword" id="afterword">Afterword</a></h1>
<h1><a class="header" href="#glossary" id="glossary">Glossary</a></h1>
<h1><a class="header" href="#bibliography" id="bibliography">Bibliography</a></h1>
<h1><a class="header" href="#appendices" id="appendices">Appendices</a></h1>
<h1><a class="header" href="#the-origins-of-lisp" id="the-origins-of-lisp">The Origins of Lisp</a></h1>
<h1><a class="header" href="#the-origins-of-erlang" id="the-origins-of-erlang">The Origins of Erlang</a></h1>
<h1><a class="header" href="#an-overview-of-lfe" id="an-overview-of-lfe">An Overview of LFE</a></h1>
<h1><a class="header" href="#feedback-and-documantation-bugs" id="feedback-and-documantation-bugs">Feedback and Documantation Bugs</a></h1>
<p>If you would like to provide feedback about this guide, we would welcome the
chance to improve the experience for everyone. Please
<a href="https://github.com/cnbbooks/lfe-manual/issues/new">create a ticket</a> in the
Github issue tracker. Be sure to give a full description so that we can best
help you!</p>
<meta http-equiv="refresh" content="0; URL=http://docs.lfe.io/" />
<h1><a class="header" href="#lfe-rebar3-plugin" id="lfe-rebar3-plugin">LFE rebar3 Plugin</a></h1>
<meta http-equiv="refresh" content="0; URL=https://github.com/rust-lang/mdbook/" />

                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    

                    

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            

            
        </nav>

    </div>

    

    
    <!-- Google Analytics Tag -->
    <script type="text/javascript">
        var localAddrs = ["localhost", "127.0.0.1", ""];

        // make sure we don't activate google analytics if the developer is
        // inspecting the book locally...
        if (localAddrs.indexOf(document.location.hostname) === -1) {
            (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-38274766-4', 'auto');
            ga('send', 'pageview');
        }
    </script>
    

    

    
    <script type="text/javascript">
        window.playground_copyable = true;
    </script>
    

    

    
    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
    

    <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="book.js" type="text/javascript" charset="utf-8"></script>

    <!-- Custom JS scripts -->
    

    
    
    <script type="text/javascript">
        window.addEventListener('load', function () {
            window.setTimeout(window.print, 100);
        });
    </script>
    
    

</body>

</html>
